<!doctype html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8"/>
  <title th:text="'Ошибка — ' + (status != null ? status : '')">Ошибка</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <style>
    :root { --fg:#111; --muted:#666; --line:#e5e7eb; --err:#b00020; --bgerr:#fff3f3; }
    body { margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Arial; color:var(--fg); line-height:1.5; }
    .container { margin:24px; }
    h1 { margin:0 0 8px; }
    .muted { color:var(--muted); }
    .card { border:1px solid var(--line); border-radius:12px; padding:16px; background:#fff; }
    .row { margin:12px 0; }
    .error { background:var(--bgerr); border:1px solid #f5c2c2; color:var(--err); padding:12px; border-radius:8px; }
    code.k { padding:2px 6px; background:#f3f4f6; border:1px solid #e5e7eb; border-radius:6px; }
    a.btn { display:inline-block; padding:8px 12px; border-radius:8px; text-decoration:none; background:#111; color:#fff; border:1px solid #111; }
    a.btn.secondary { background:#fff; color:#111; border-color:#ddd; }
    pre { background:#0b1021; color:#e8eaf6; padding:12px; border-radius:8px; overflow:auto; }
    details > summary { cursor:pointer; font-weight:600; margin-bottom:6px; }
  </style>
</head>
<body>

  <!-- общий навбар -->
  <div th:replace="~{fragments/nav :: nav(${bank}, ${login}, ${consentId}, ${baseUrl})}"></div>

  <div class="container">
    <h1>Ошибка запроса</h1>

    <!-- верхний блок -->
    <div class="row card">
      <div class="row">
        <b>Статус:</b>
        <code class="k" th:text="${status != null ? status : '—'}">—</code>
        <span class="muted" style="margin-left:8px" th:text="${error != null ? error : ''}"></span>
      </div>
      <div class="row" th:if="${path}">
        <b>Путь:</b> <code class="k" th:text="${path}">/…</code>
      </div>
      <div class="row" th:if="${timestamp}">
        <b>Время:</b> <span th:text="${timestamp}">—</span>
      </div>
      <div class="row error" th:if="${message}" th:text="${message}">Неизвестная ошибка</div>
    </div>

    <!-- тело ошибки/trace если есть -->
    <div class="row" th:if="${exception} or ${trace} or ${apiErrorBody}">
      <details open>
        <summary>Диагностика</summary>
        <div class="row" th:if="${exception}">
          <div class="muted">Исключение:</div>
          <pre th:text="${exception}">—</pre>
        </div>
        <div class="row" th:if="${trace}">
          <div class="muted">Stack trace:</div>
          <pre th:text="${trace}">—</pre>
        </div>
        <div class="row" th:if="${apiErrorBody}">
          <div class="muted">API error body:</div>
          <pre th:text="${apiErrorBody}">—</pre>
        </div>
      </details>
    </div>

    <div class="row">
      <a class="btn secondary" href="javascript:history.back()">← Назад</a>
      <a class="btn" href="/">На главную</a>
    </div>
  </div>
</body>
</html>
