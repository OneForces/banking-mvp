<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8"/>
  <title>Новая заявка на кредит</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <style>
    :root{ --fg:#111; --muted:#666; --line:#e5e7eb; --err:#b00020; --bgerr:#fff3f3; --ok:#065f46; --bgok:#ecfdf5; }
    body{ font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Arial; margin:0; line-height:1.5; color:var(--fg); }
    .container{ margin:24px; }
    h1{ margin:0 0 8px; }
    .muted{ color:var(--muted); }
    .row{ margin:12px 0; }
    form{ display:grid; grid-template-columns:1fr 1fr; gap:12px 16px; }
    label{ display:flex; flex-direction:column; gap:6px; }
    input, select, textarea{ padding:8px 10px; border:1px solid #ddd; border-radius:8px; font:inherit; }
    .full{ grid-column:1 / -1; }
    .actions{ display:flex; gap:8px; }
    .btn{ display:inline-block; padding:8px 12px; border-radius:8px; border:1px solid #111; background:#111; color:#fff; text-decoration:none; cursor:pointer; }
    .btn.secondary{ background:#fff; color:#111; border-color:#ddd; }
    .error{ background:var(--bgerr); border:1px solid #f5c2c2; color:var(--err); padding:12px; border-radius:8px; }
    .ok{ background:var(--bgok); border:1px solid #a7f3d0; color:var(--ok); padding:12px; border-radius:8px; }
    pre{ background:#0b1021; color:#e8eaf6; padding:12px; border-radius:8px; overflow:auto; }
  </style>
</head>
<body>

  <!-- Навигация -->
  <div th:replace="~{fragments/nav :: nav(${bank}, ${login}, ${consentId}, ${baseUrl})}"></div>

  <div class="container">
    <h1>Новая заявка на кредит</h1>
    <div class="muted" th:text="${'(' + (#strings.toUpperCase((bank != null ? bank : 'v')) + 'Bank') + (baseUrl != null ? ' · ' + baseUrl : '') + ')'}">VBank</div>

    <!-- Сообщения -->
    <div class="row error" th:if="${error}" th:text="${error}">Ошибка</div>
    <div class="row ok" th:if="${info}" th:text="${info}">Заявка создана</div>

    <!-- Форма заявки -->
    <form class="row" th:action="@{/loan/new}" method="post" enctype="multipart/form-data">
      <!-- Контекст -->
      <label>
        Банк
        <select name="bank">
          <option value="v" th:selected="${(bank != null ? bank : 'v') == 'v'}">VBank</option>
          <option value="a" th:selected="${bank == 'a'}">ABank</option>
          <option value="s" th:selected="${bank == 's'}">SBank</option>
        </select>
      </label>

      <label>
        Логин клиента (client_id)
        <input type="text" name="login" th:value="${login}" placeholder="team101-1" required/>
      </label>

      <!-- Основные параметры -->
      <label>
        Продукт
        <select name="productId" required>
          <option value="" disabled selected>Выберите продукт…</option>
          <option th:each="p : ${products}" th:value="${p.productId}" th:text="${p.productName}">Кредит наличными</option>
        </select>
      </label>

      <label>
        Сумма, ₽
        <input type="number" min="10000" step="1000" name="amount" placeholder="300000" required/>
      </label>

      <label>
        Срок, месяцев
        <input type="number" min="1" max="120" step="1" name="termMonths" placeholder="24" required/>
      </label>

      <label>
        Ежемесячный доход, ₽
        <input type="number" min="0" step="1000" name="incomeMonthly" placeholder="120000" required/>
      </label>

      <label class="full">
        Цель кредита
        <textarea name="purpose" rows="2" placeholder="Ремонт / образование / рефинансирование …"></textarea>
      </label>

      <!-- Документы -->
      <label>
        Паспорт (PDF/JPEG)
        <input type="file" name="docPassport" accept=".pdf,image/*"/>
      </label>

      <label>
        Справка о доходах (PDF/JPEG)
        <input type="file" name="docIncome" accept=".pdf,image/*"/>
      </label>

      <div class="full actions">
        <button class="btn" type="submit">Отправить заявку</button>
        <a class="btn secondary" href="/">На главную</a>
      </div>
    </form>

    <!-- Сырые данные/ответ -->
    <div class="row" th:if="${requestJson}">
      <h3>Отправленный payload</h3>
      <pre th:text="${requestJson}">—</pre>
    </div>
    <div class="row" th:if="${responseJson}">
      <h3>Ответ API</h3>
      <pre th:text="${responseJson}">—</pre>
    </div>
  </div>

</body>
</html>
